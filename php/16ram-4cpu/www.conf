[www]
; --- identity ---
user  = www-data
group = www-data

; --- listen (Apache proxy via :9000) ---
listen = 0.0.0.0:9000
listen.backlog = 256
listen.owner  = www-data
listen.group  = www-data
listen.mode   = 0660

; ================= Process Manager =================
; With ~4GB for php-fpm and WP/Woo typical peak ~80–120MB per worker,
; cap to ~28–32 workers for headroom (OPcache, CLI bursts, composer, etc.)
pm = dynamic
pm.max_children = 30            ; sweet spot for your 4GB php container
pm.start_servers = 8
pm.min_spare_servers = 8
pm.max_spare_servers = 16

; recycle to avoid leaks in long-lived pools
pm.max_requests = 1500

; --- timeouts / stability ---
; Allow slow Woo admin ops and heavy AJAX during peaks without runaway procs.
request_terminate_timeout = 180s
request_slowlog_timeout   = 0
; slowlog = /var/log/php-fpm/slowlog.log

; --- status/health (keep for metrics) ---
pm.status_path = /fpm-status
ping.path      = /fpm-ping

; --- env pass-through (optional) ---
; env[APP_ENV] = production

; --- file/resource limits (leave defaults unless you hit limits) ---
; rlimit_files = 8192
; rlimit_core  = 0

; --- harden logging at pool level (optional) ---
; php_admin_value[error_log] = /var/log/php/error.log
; php_admin_flag[log_errors] = on
