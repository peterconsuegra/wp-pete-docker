; ======================= Pete — PHP (Production) =======================
; Host: Hetzner CCX23 (16 GB / 4 vCPU)
; Container: php (mem_limit ≈ 4096M, cpus ≈ 1.4)
; FPM pool: pm.max_children = 30 (see www.conf)
;
; Goal:
;   • Stable Woo/WordPress under high traffic
;   • Keep single-request memory high enough (heavy plugins/builders)
;   • But remain safe within a 4G cgroup limit
; ======================================================================

default_charset = "UTF-8"

; ----------------------------------------------------------------------
; 1. Core resource limits
; ----------------------------------------------------------------------
; NOTE:
;   memory_limit (512M) × 30 children > 4G on paper, but in practice
;   requests rarely hit the hard cap simultaneously. If you see OOM
;   in this container, either:
;     • lower memory_limit to 384M/256M, or
;     • reduce pm.max_children from 30.
memory_limit       = 512M          ; required by your plugin (min 512M)

max_execution_time = 90            ; tight enough for web; long jobs via CLI
max_input_time     = 60
max_input_vars     = 6000          ; safer for Woo + big admin screens

; uploads (tune if your store needs bigger assets)
post_max_size      = 64M
upload_max_filesize = 64M
max_file_uploads   = 50            ; sane default for admin uploads

; ----------------------------------------------------------------------
; 2. Visibility / logging
; ----------------------------------------------------------------------
expose_php         = Off
display_errors     = Off
log_errors         = On
error_reporting    = E_ALL & ~E_DEPRECATED & ~E_STRICT

; Optional: point PHP errors to a volume-mounted log if needed
; error_log = /var/log/php/error.log
; log_errors_max_len = 16384

; ----------------------------------------------------------------------
; 3. OPcache (Production, 4G container)
; ----------------------------------------------------------------------
; WordPress/Woo benefits from a warm, stable cache. No timestamp checks.
opcache.enable                = 1
opcache.enable_cli            = 0           ; keep CLI clean; enable only if needed
opcache.validate_timestamps   = 0           ; PROD: disable stat() checks
opcache.revalidate_freq       = 0
opcache.file_update_protection = 2

; Size: fits large WP/Woo installs + builders, within 4GB limit
opcache.memory_consumption   = 256
opcache.interned_strings_buffer = 32
opcache.max_accelerated_files = 200000
opcache.save_comments        = 1

; JIT rarely helps WP + can add overhead → keep off
opcache.jit                  = 0
opcache.jit_buffer_size      = 0

; optional small stability tweaks
opcache.max_wasted_percentage = 10

; ----------------------------------------------------------------------
; 4. Filesystem resolver speed
; ----------------------------------------------------------------------
; With many plugins/themes, bump cache a bit to reduce stat() calls.
realpath_cache_size = 16384K
realpath_cache_ttl  = 1800

; ----------------------------------------------------------------------
; 5. Sessions / output
; ----------------------------------------------------------------------
session.gc_probability = 1
session.gc_divisor     = 1000
session.gc_maxlifetime = 28800      ; 8h, aligns well with Woo sessions

output_buffering       = 0

; ----------------------------------------------------------------------
; 6. Sane defaults for sockets / streams
; ----------------------------------------------------------------------
default_socket_timeout = 30

; ----------------------------------------------------------------------
; 7. Misc hardening / compatibility
; ----------------------------------------------------------------------
; date.timezone should be set at container level if needed:
; date.timezone = "America/Bogota"

; Disable dangerous functions here if you don’t rely on them in plugins.
; disable_functions = exec,passthru,shell_exec,system,proc_open,popen
