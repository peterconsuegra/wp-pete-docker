[www]
; --- identity ---
user  = www-data
group = www-data

; --- listen (proxy via :9000 from Apache) ---
listen = 0.0.0.0:9000
listen.backlog = 256
listen.owner  = www-data
listen.group  = www-data
listen.mode   = 0660

; --- process manager ---
pm = dynamic

; With 4GB host and dev workloads, assume ~80–100MB per PHP worker peak.
; Reserve headroom for OS, OPcache, Composer, and bursts → cap to ~24 workers.
pm.max_children = 24
pm.start_servers = 6
pm.min_spare_servers = 6
pm.max_spare_servers = 12

; recycle to avoid slow leaks in dev
pm.max_requests = 500
pm.process_idle_timeout = 10s

; --- status/health ---
pm.status_path = /fpm-status
ping.path      = /fpm-ping

; --- timeouts that help avoid stuck requests in dev ---
request_terminate_timeout = 180s
request_slowlog_timeout   = 0
; slowlog = /var/log/php-fpm/slowlog.log

; --- environment pass-through (optional) ---
; env[APP_ENV] = $PETE_ENVIRONMENT
; env[COMPOSER_HOME] = /tmp

; --- limits (keep defaults unless you hit open file limit issues) ---
; rlimit_files = 4096
; rlimit_core  = 0
