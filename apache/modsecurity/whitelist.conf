# remove false-positives first
SecAction \
  "id:10000,\
   phase:1,\
   pass,\
   nolog,\
   ctl:ruleRemoveById=953100,\
   ctl:ruleRemoveById=959100,\
   ctl:ruleRemoveById=980170"

# now per-path disables, each with a different ID
SecRule REQUEST_URI "@beginsWith /wp-admin" \
    "id:1000001,phase:1,pass,nolog,ctl:ruleEngine=Off"
SecRule REQUEST_URI "@beginsWith /admin/phpinfo" \
    "id:1000002,phase:1,pass,nolog,ctl:ruleEngine=Off"
SecRule REQUEST_URI "@beginsWith /admin/phpinfo/view" \
    "id:1000003,phase:1,pass,nolog,ctl:ruleEngine=Off"
SecRule REQUEST_URI "@beginsWith /validate-pete" \
    "id:1000004,phase:1,pass,nolog,ctl:ruleEngine=Off"
SecRule REQUEST_URI "@beginsWith /pete_plugins_install" \
    "id:1000005,phase:1,pass,nolog,ctl:ruleEngine=Off"
SecRule REQUEST_URI "@beginsWith /pete_update" \
    "id:1000006,phase:1,pass,nolog,ctl:ruleEngine=Off"
SecRule REQUEST_URI "@beginsWith /update_post" \
    "id:1000007,phase:1,pass,nolog,ctl:ruleEngine=Off"
SecRule REQUEST_URI "@beginsWith /phpmyadmin" \
    "id:1000008,phase:1,pass,nolog,ctl:ruleEngine=Off"
SecRule REQUEST_URI "@beginsWith /phpmyinfo" \
    "id:1000009,phase:1,pass,nolog,ctl:ruleEngine=Off"
SecRule REQUEST_URI "^/app[0-9]+/update_post$" \
    "id:1000010,phase:1,pass,nolog,ctl:ruleEngine=Off"
SecRule REQUEST_URI "@beginsWith /internal-certbot" "id:1000011,phase:1,pass,nolog,ctl:ruleEngine=Off"
SecRule REQUEST_URI "@beginsWith /internal-reload"  "id:1000012,phase:1,pass,nolog,ctl:ruleEngine=Off"

SecRule REQUEST_URI "@beginsWith /pete_plugins" \
    "id:10000011,phase:1,pass,nolog,ctl:ruleEngine=Off"
SecRule REQUEST_URI "@beginsWith /oupdates" \
    "id:10000012,phase:1,pass,nolog,ctl:ruleEngine=Off"
SecRule REQUEST_URI "@beginsWith /wp_plugins" \
    "id:10000013,phase:1,pass,nolog,ctl:ruleEngine=Off"
SecRule REQUEST_URI "@beginsWith /pete_installers" \
    "id:10000014,phase:1,pass,nolog,ctl:ruleEngine=Off"
SecRule REQUEST_URI "@beginsWith /wp_global_options" \
    "id:10000015,phase:1,pass,nolog,ctl:ruleEngine=Off"
SecRule REQUEST_URI "@beginsWith /validate_site_json" \
    "id:10000016,phase:1,pass,nolog,ctl:ruleEngine=Off"
SecRule REQUEST_URI "@beginsWith /wp-json/pete/v1" \
    "id:10000017,phase:1,pass,nolog,ctl:ruleEngine=Off"
SecRule REQUEST_URI "@beginsWith /plugins" \
    "id:10000018,phase:1,pass,nolog,ctl:ruleEngine=Off"


#Pete 12 dashboard rules
SecRule REQUEST_URI "@beginsWith /wordpress-importer" \
    "id:910004,phase:1,pass,nolog,ctl:ruleRemoveById=200004"

# =========================
# WooCommerce allow-list
# =========================

# 1) Turn ModSecurity OFF for Woo AJAX calls like:
#    /?wc-ajax=update_order_review, /?wc-ajax=checkout, etc.
SecRule QUERY_STRING "@contains wc-ajax=" \
  "id:1000100,phase:1,pass,nolog,ctl:ruleEngine=Off"

# 2) Turn ModSecurity OFF for admin-ajax.php (some WC add-ons use it on checkout)
SecRule REQUEST_URI "@endsWith /wp-admin/admin-ajax.php" \
  "id:1000101,phase:1,pass,nolog,ctl:ruleEngine=Off"

# 3) Turn ModSecurity OFF for legacy wc-api callbacks from gateways/webhooks
SecRule QUERY_STRING "@contains wc-api=" \
  "id:1000102,phase:1,pass,nolog,ctl:ruleEngine=Off"

# 4) (Optional) If you prefer to KEEP ModSec ON and only remove noisy rules
#    for specific Woo endpoints, use these surgical disables.
#    Adjust the rule IDs to match your audit log if different.
#    Common OWASP CRS offenders during WC checkout:
#      942100 (SQLi), 942110 (SQLi operators), 941100 (XSS), 941160 (XSS NoScript),
#      930120 (OS file access false positive), 942430 (common sqli char classes)
#    We'll remove them ONLY for update_order_review and checkout.
SecRule QUERY_STRING "@rx \bwc-ajax=(update_order_review|checkout|apply_coupon|get_cart_totals)\b" \
  "id:1000110,phase:1,pass,nolog,\
  ctl:ruleRemoveById=942100,\
  ctl:ruleRemoveById=942110,\
  ctl:ruleRemoveById=941100,\
  ctl:ruleRemoveById=941160,\
  ctl:ruleRemoveById=930120,\
  ctl:ruleRemoveById=942430"

# 5) (Optional) Some gateways hit wc-api with payloads that trigger CRS; relax for those only
SecRule QUERY_STRING "@rx \bwc-api=\w+" \
  "id:1000111,phase:1,pass,nolog,\
  ctl:ruleRemoveById=942100,\
  ctl:ruleRemoveById=942110,\
  ctl:ruleRemoveById=941100,\
  ctl:ruleRemoveById=941160"


    