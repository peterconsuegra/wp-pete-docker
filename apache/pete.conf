<VirtualHost _default_:80>
    ServerName localhost
    DocumentRoot /var/www/html/Pete/public

    <Directory /var/www/html/Pete/public>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # Only boost limits on clone endpoints
    <LocationMatch "^/(clone|sites/clone)(/.*)?$">
        <IfModule proxy_fcgi_module>
            ProxyFCGISetEnvIf "true" PHP_ADMIN_VALUE "
                max_execution_time=1800
                max_input_time=1800
                default_socket_timeout=1800
                memory_limit=1024M
            "
        </IfModule>
    </LocationMatch>

    # Long-running operations (site clone) can exceed 60s
    Timeout 1800
    ProxyTimeout 1800

    LimitRequestBody 0

    <Location "/wordpress-importer">
        SecRuleEngine Off
        SecRequestBodyAccess Off
    </Location>

    # send PHP to FPM
    <FilesMatch "\.php$">
        SetHandler "proxy:fcgi://php:9000"
    </FilesMatch>

    # graceful-reload hook (now inside the vhost)
    ScriptAlias /internal-reload /usr/local/bin/reload_apache.cgi
    <Directory "/usr/local/bin">
        Options +ExecCGI
        Require local
        Require ip 172.16.0.0/12
    </Directory>

    ScriptAlias /internal-certbot /usr/local/bin/issue_cert.cgi
    <Directory "/usr/local/bin">
        Options +ExecCGI
        Require local
        Require ip 172.16.0.0/12
    </Directory>

    ScriptAlias /modsecurity-status /usr/local/bin/modsecurity_status.cgi
    <Directory "/usr/local/bin">
        Options +ExecCGI
        Require local
        Require ip 172.16.0.0/12
    </Directory>

    LogLevel debug
    ErrorLog  /var/www/html/wwwlog/Pete/error.log
    CustomLog /var/www/html/wwwlog/Pete/access.log combined
</VirtualHost>